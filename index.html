// Replace your generateProblem and processHit functions with these updated versions:

function generateProblem() {
    let a, b, ans, op;
    
    if (round <= 3) {
        // Simple Addition
        a = Math.floor(Math.random() * 10) + 1;
        b = Math.floor(Math.random() * 10) + 1;
        ans = a + b;
        op = "+";
    } else if (round <= 6) {
        // Subtraction (ensure positive result)
        a = Math.floor(Math.random() * 20) + 5;
        b = Math.floor(Math.random() * a);
        ans = a - b;
        op = "-";
    } else {
        // Multiplication
        a = Math.floor(Math.random() * 12) + 1;
        b = Math.floor(Math.random() * 12) + 1;
        ans = a * b;
        op = "Ã—";
    }

    currentProblem = { question: `${a} ${op} ${b} = ?`, answer: ans };
    document.getElementById('problem').innerText = currentProblem.question;
    document.getElementById('problem').style.color = "#f1c40f";
}

function processHit(hx, hy, finalScale) {
    const dx = hx - centerX;
    const dy = hy - centerY;
    const dist = Math.sqrt(dx*dx + dy*dy);
    
    lastHit = { x: hx, y: hy, show: true, scale: finalScale };

    if (dist > boardRadius) {
        document.getElementById('problem').innerText = "MISS!";
        document.getElementById('problem').style.color = "#95a5a6";
    } else {
        // Calculate the slice hit
        let angle = Math.atan2(dy, dx);
        let normalizedAngle = angle + Math.PI / 2 + (Math.PI * 2 / 40);
        if (normalizedAngle < 0) normalizedAngle += Math.PI * 2;
        const sliceIndex = Math.floor((normalizedAngle / (Math.PI * 2)) * 20) % 20;
        const boardValue = boardValues[sliceIndex];

        // Scoring Modifiers (Standard Dartboard distances)
        let multiplier = 1;
        if (dist > 200 && dist < 220) multiplier = 2; // Double Ring
        if (dist > 120 && dist < 140) multiplier = 3; // Triple Ring
        if (dist < 15) { // Bullseye
            score += 50; 
            document.getElementById('problem').innerText = "BULLSEYE! +50";
            document.getElementById('problem').style.color = "#2ecc71";
        } else if (boardValue === currentProblem.answer) {
            let points = 10 * multiplier;
            score += points;
            let bonusText = multiplier > 1 ? ` (${multiplier}x Bonus!)` : "";
            document.getElementById('problem').innerText = `CORRECT! +${points}${bonusText}`;
            document.getElementById('problem').style.color = "#2ecc71";
        } else {
            document.getElementById('problem').innerText = `WRONG! Hit ${boardValue}`;
            document.getElementById('problem').style.color = "#e74c3c";
        }
    }

    round++;
    document.getElementById('score').innerText = score;
    
    setTimeout(() => {
        lastHit.show = false;
        if (round <= 10) {
            document.getElementById('round').innerText = round;
            generateProblem();
        } else {
            document.getElementById('problem').innerText = `GAME OVER! FINAL: ${score}`;
            document.getElementById('problem').style.color = "#f1c40f";
        }
    }, 2000);
}
